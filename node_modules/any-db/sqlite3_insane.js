var assert = require('assert')
	, sql3 = require('sqlite3')
	, filename= '/tmp/blah'

var CREATE = 'CREATE TABLE my_test_table (my_col int)'
	, INSERT = 'INSERT INTO my_test_table (my_col) VALUES (1)'
	, SELECT = 'SELECT * FROM my_test_table'

require('fs').unlinkSync(filename)
var d1 = new sql3.Database(filename)
	, d2 = new sql3.Database(filename)

d1.on('open', function () { 
	d1.serialize()
	d2.serialize()
	d1.exec(CREATE, function () {
		d2.all(SELECT, function (err, res) {
			empty(err, res)
			d2.exec(INSERT, function (err) {
				assert(!err, ""+err)
				d1.all(SELECT, function (err, res) {
				})
			})
			d1.all(SELECT, empty)
			d2.all(SELECT, notEmpty)
		})
	})
})

function empty(err, res) {
	assert(!err, ""+err)
	assert.equal(res.length, 0)
}

function notEmpty(err, res) {
	assert(!err, ""+err)
	assert(res.length)
}
